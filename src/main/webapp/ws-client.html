<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Web Service Client</title>
<link rel="stylesheet" href="jquery-lib/qunit-2.3.3.css">
<link rel="stylesheet" href="helloworld.css">
<script src="jquery-lib/jquery-3.2.1.js"></script>
<script src="jquery-lib/qunit-2.3.3.js"></script>
	<script>
		$(document).ready(function(){
			$("#btnSubmit").click(function(){
				$.post("http://localhost:8080/hello-world/rest/hello-ws/post",
					{
						"user": $("#tbUser").val(),
						"text": $("#tbInput").val()
					},
					function(data){
						var items = [];
						$.each( data, function(key, val) {
							if(key=="last-msg"){
								$("#divRetDisp").html(val);
							}else{
								items.push("<tr id='" + key + "' onclick='$(\"#"+key+"_rep\").css(\"display\",\"inline\")'><td>" + val.msg +"</td><td>"+val.created+"</td></tr>");
								items.push("<tr id='" + key + "_rep' style='display:none'><td colspan='2' id='td_"+key+"'><input type='text'/></td></tr>");
							}
						});

						$("#divMsgs").html("<table id='tblMsgs'><tr><th>Message</th><th>Created</th></tr>"+items.join( "" )+"</table>");



						$.each( data, function(key, val) {
							if(key!="last-msg"){
								$("<input/>",{type: "button", 
									id: "btnRep_"+key,
									val:"Reply", 
									"height": "25px",
									"css" : {"background-color" : "#4286f4"},
									click: function(){
										alert("I am: "+this.id+" and you are: "+$("#td_"+key).attr("id")+"and msg is: "+val.msg);
									}
								}).appendTo($("#td_"+key));
							}
						});





					}					
				);




			});

			//$(document.createElement("input")).attr({id:"123", type:"button"}).appendTo(158);
	




		});		
	</script>
	
	<!-- QUnit tests -->
	<!--script>
		$(document).ready(function(){
			var testTxt = "TeSt String";
			var testUsr = "tester";
			
			$("#tbInput").val(testTxt);
			$("#tbUser").val(testUsr);
			
			$("#btnSubmit").trigger("click");
	
			QUnit.test("Unit Test for client page", function(assert){
		        var done = assert.async(4);
		        
		        //Positive test case
		        setTimeout(function() {
		        	assert.equal(testTxt, $("#divRetDisp").html(), "Text should be the same" );
		           done();
		        }, 500);
		        
		        setTimeout(function() {
		        	assert.equal(testUsr, $("#tbUser").val(), "User shoud remain unchanged" );
		           done();
		        }, 500);

				// There should be at least one row: the one used in this test + header = at least 2
		        setTimeout(function() {
		        	assert.notEqual(1, $("#tblMsgs tr").length, "Mesages are not empty" );
		           done();
		        }, 500);

		        //Negative test case
		        setTimeout(function() {
		        	assert.notEqual("some other text", $("#divRetDisp").html(), "Text to compare is different" );
		           done();
		        }, 500);
	        });			
		});

	</script-->
</head>
<body>
	<table>
		<tr>
			<td>Username:</td>
			<td colspan="2"><input type="text" id="tbUser"></td>
		</tr><tr>
			<td>Text:</td>
			<td><input type="text" id="tbInput"/></td>
			<td><button id="btnSubmit">Done</button></td>
		</tr><tr>
			<td colspan="3"><div id="divRetDisp"></div></td>
		</tr>
	</table><br><br><br>
	<div id="divMsgs" class="hw-div"></div>

	<!-- Unit Test-->
	<!--div id="qunit-section">
		<h3>QUnit section:</h3>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
	</div-->

</body>
</html>